name: Newsletter Cron (Every 30 Minutes)

on:
  schedule:
    # Runs every 30 minutes (at :00 and :30 of each hour)
    - cron: '*/30 * * * *'
  workflow_dispatch: # Allows manual triggering

jobs:
  send-newsletter:
    runs-on: ubuntu-latest
    
    steps:
    - name: Trigger Newsletter
      run: |
        curl -X GET \
          -H "Content-Type: application/json" \
          -H "User-Agent: GitHub-Actions" \
          "https://testbackend-dkivrl6b6-ajay-s-projects-7337fb6b.vercel.app/api/cron/newsletter"

    - name: Check Newsletter Status
      run: |
        sleep 30
        curl -s "https://testbackend-dkivrl6b6-ajay-s-projects-7337fb6b.vercel.app/api/newsletter/status" | \
        python3 -c "
        import sys, json
        data = json.load(sys.stdin)
        print(f\"Newsletter Status: {data['data']['lastNewsletter']['completedTime']}\")
        print(f\"Emails Sent: {data['data']['lastNewsletter']['emailsSent']}\")
        "
